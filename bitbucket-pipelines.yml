#  Template Java Gradle build

#  This template allows you to test and build your Java project with Gradle.
#  The workflow allows running tests, code checkstyle and security scans on the default branch.

# Prerequisites: appropriate project structure should exist in the repository.

image: openjdk:15

pipelines:
  default:
    - step:
        script:
          - echo "Nothing to do here"
  branches:
    master:
      - step:
          name: Build
          caches:
            - gradle
          script:
            - bash ./gradlew packageMsi
          artifacts:
            - /build/compose/binaries/main/msi/**
      - step:
          name: Test jfrog connection
          script:
            - pipe: jfrog/jfrog-setup-cli:1.0.0
            - source ./jfrog-setup-cli.sh
            - jfrog rt ping
      - step:
          name: Deployment to Production
          deployment: production
          script:
            - pipe: jfrog/artifactory-generic-upload:0.3.2
              variables:
                ARTIFACTORY_URL: $ARTIFACTORY_URL
                ARTIFACTORY_USER: $ARTIFACTORY_USER
                ARTIFACTORY_PASSWORD: $ARTIFACTORY_PASSWORD
                FILE_SPEC: "false"
                SOURCE_PATH: "/build/compose/binaries/main/msi/*.msi"
                TARGET_PATH: "msi/"
                BUILD_NAME: "msi-build"
